<!-- Request Calendar Event Modal -->
<ng-template #calEvent let-c="close" let-d="dismiss">

  <div class="modal-container">

    <div class="modal-header">
      <h4 class="modal-title" id="modal-basic-title"> <i class="fa fa-home"> </i> {{ selectedRequest.name }} : {{ selectedRequest.address }} </h4>
      <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>

    <div class="modal-body">
      <div class="submit-message alert alert-success" *ngIf="isSubmitSuccess" role="alert">
        Cool! Your schedule is updated on your calendar.
      </div>
      <form novalidate #f="ngForm" (ngSubmit)="addEvent(f.value)" class="">
        <div class="row">
          <div class="col-8">
            <div class="form-group">
              <div class="row">
                <label class="col-3"> Appointment Title  <span class="pull-right"> : </span> </label>
                <div class="col-9">
                  <input type="text" name="schedule_title" class="form-control" ngModel>
                </div>
              </div>
            </div>

            <div class="form-group">
              <div class="row">
                <label class="col-3"> Appointment Description  <span class="pull-right"> : </span> </label>
                <div class="col-9">
                  <textarea name="schedule_desc" class="form-control" ngModel rows="3" cols="80"></textarea>
                </div>
              </div>
            </div>

            <div class="form-group">
              <div class="row">
                <label class="col-3"> Appointment Start Time  <span class="pull-right"> : </span> </label>
                <div class="col-6">
                  <input type="datetime" name="schedule_start_time" class="form-control" [(ngModel)]="startTime" readonly >
                </div>
              </div>
            </div>

            <div class="form-group">
              <div class="row">
                <label class="col-3"> Appointment End Time  <span class="pull-right"> : </span> </label>
                <div class="col-6">
                  <input type="datetime" name="schedule_end_time" class="form-control" [(ngModel)]="endTime" readonly >
                </div>
              </div>
            </div>

          </div>

        </div>

        <div class="row">
          <div class="col-8 align-right">
            <hr />
            <button class="btn btn-default btn-primary save pull-right" type="submit" [disabled]="isSubmitSuccess ? true : null"> Schedule </button>
            <button type="button" class="btn btn-secondary" (click)="d('Cross click')">Close</button>
          </div>
        </div>

      </form>
    </div>

  </div>

</ng-template>

<ng-template #goToDate let-c="close" let-d="dismiss">

  <div class="modal-container">

    <div class="modal-header">
      <h4 class="modal-title" id="modal-basic-title"> <i class="fa fa-home"> </i> Specify a date </h4>
      <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>

    <div class="modal-body">
      <form novalidate #f1="ngForm" (ngSubmit)="goToDateEvent(f1.value)" class="tab-info tab-content">
        <div class="row">

          <div class="col-8">

            <div class="form-group">
              <div class="row">
                <label class="col-3"> Date  <span class="pull-right"> : </span> </label>
                <div class="col-6">
                  <input type="date" name="goToSpecificDate" class="form-control" [(ngModel)]="startTime">
                </div>
              </div>
            </div>

          </div>

        </div>

        <div class="row">
          <div class="col-8 align-right">
            <hr />
            <button class="btn btn-default btn-primary save pull-right" type="submit" [disabled]="isSubmitSuccess ? true : null"> Submit </button>
            <button type="button" class="btn btn-secondary" #closeGoToDate (click)="d('Cross click')">Close</button>
          </div>
        </div>

      </form>
    </div>

  </div>

</ng-template>

<!-- Requests tab -->
<div class="row">
  <div class="col col-xl-12 col-lg-12">
    <div class="card mb-12">


    <div class="card-body table-responsive">

      <!-- Requests list table -->
      <table class="table" [hidden]="!showReqListTable">
        <thead>
          <tr>
            <th>#</th>
            <th>Venue</th>
            <th> PC Name </th>
            <th>Event</th>
            <th>Date</th>
            <th>#Guests</th>
            <th> Mobile Number </th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let req of requestsList; let i = index;">
            <td scope="row">{{ i + 1 }}</td>
            <td>{{ req.name}}</td>
            <td>{{ req.pc_name  }}  </td>
            <td>{{ req.event_type_name }}</td>
            <td>{{ req.event_date | date: 'yyyy-MMM-dd' }}</td>
            <td>{{ req.guest_count_list }}</td>
            <td>{{ req.mobile_number}}  </td>
            <td>{{ req.status_text }}</td>
            <td>
              <i class="fa fa-fw fa-edit" (click)="showMoreDetails(i)" data-toggle="modal" data-target="#exampleModal"></i>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Calendar application -->
      <div class='app' [hidden]="!showCalendar">
        <div class='app-calendar' *ngIf="calendarVisible">
          <full-calendar
          #calendar
          defaultView="dayGridMonth"
          [header]="{
            left: 'prev,next',
            center: 'title',
            right: 'dayGridMonth, timeGridWeek, timeGridDay, listWeek'
          }"
          [allDaySlot]="false"
          [businessHours]="calendarBusinessHours"
          [plugins]="calendarPlugins"
          [events]="calendarEvents"
          (dateClick)="handleDateClick($event, calEvent)"
          [selectConstraint]="businessHours"
          [selectable]="true"
          [minTime]="minimumTime"
          [maxTime]="maximumTime"
          hiddenDays="[0,5,6]"
          [validRange]="validRange"
          [height]="400"
          [hour]="numeric"
          [slotLabelFormat]="{
              hour: '2-digit',
              minute: '2-digit',
              omitZeroMinute: false,
              meridiem: 'long',
              hour12: false
          }"
          ></full-calendar>
        </div>
        <div class="row">
          <div class="col-12">
            <button type="button" class="btn btn-md btn-primary btn-default margin-top-20 pull-right" name="button" (click)="showAdminCalendar(false)">Go Back To Requests List</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</div>

<!-- Request Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" data-backdrop="static">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Request Details</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="d('Cross click')">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-6">
            <div class="row">
              <div class="col-5 left-heading">
                <label for="" > Venue Name </label>
                <span class="pull-right">:</span>
              </div>
              <div class="col-7">
                {{ selectedRequest.name }}
              </div>
            </div>
          </div>
          <div class="col-md-12"></div>
          <div class="col-6">
            <div class="row">
              <div class="col-5 left-heading">
                <label for="" >PC Name</label>
                <span class="pull-right">:</span>
              </div>
              <div class="col-7">
                {{ selectedRequest.pc_name }}
              </div>
            </div>
          </div>
          <div class="col-6">
            <div class="row">
              <div class="col-5 left-heading">
                <label for=""> Event Type </label>
                <span class="pull-right">:</span>
              </div>
              <div class="col-7">
                {{ selectedRequest.event_type_name }}
              </div>
            </div>
          </div>
          <div class="col-6">
            <div class="row">
              <div class="col-5 left-heading">
                <label for="">Event Date</label>
                <span class="pull-right">:</span>
              </div>
              <div class="col-7">
                {{ selectedRequest.event_date | date: 'dd-MMM-y' }}
              </div>
            </div>
          </div>
          <div class="col-6">
            <div class="row">
              <div class="col-5 left-heading">
                <label for="">No Of Guests </label>
                <span class="pull-right">:</span>
              </div>
              <div class="col-7">
                {{ selectedRequest.guest_count_list }}
              </div>
            </div>
          </div>
          <div class="col-6">
            <div class="row">
              <div class="col-5 left-heading">
                <label for=""> Mobile Number </label>
                <span class="pull-right">:</span>
              </div>
              <div class="col-7">
                {{ selectedRequest.mobile_number }}
              </div>
            </div>
          </div>
          <div class="col-6">
            <div class="row">
              <div class="col-5 left-heading">
                <label for=""> Email Address </label>
                <span class="pull-right">:</span>
              </div>
              <div class="col-7">
                {{ selectedRequest.email_address }}
              </div>
            </div>
          </div>
          <div class="col-6" *ngIf="isAppReq(selectedRequest)">
            <div class="row">
              <div class="col-5 left-heading">
                <label for="">Appointment Title</label>
                <span class="pull-right">:</span>
              </div>
              <div class="col-7">
                {{ selectedRequest.appointment_title }}
              </div>
            </div>
          </div>
          <div class="col-6" *ngIf="isAppReq(selectedRequest)">
            <div class="row">
              <div class="col-5 left-heading">
                <label for="">Appointment Message</label>
                <span class="pull-right">:</span>
              </div>
              <div class="col-7">
                {{ selectedRequest.appointment_message }}
              </div>
            </div>
          </div>
          <div class="col-6" *ngIf="isAppReq(selectedRequest)">
            <div class="row">
              <div class="col-5 left-heading">
                <label for="">Appointment Time</label>
                <span class="pull-right">:</span>
              </div>
              <div class="col-7">
                {{ selectedRequest.appointment_time }}
              </div>
            </div>
          </div>
          <div class="col-6">
            <div class="row">
              <div class="col-5 left-heading">
                <label for=""> Add Comments </label>
                <span class="pull-right">:</span>
              </div>
              <div class="col-7">
                <div class="reply-text">
                  <textarea class="p-2" name="replyText"  value="" rows="4" cols="50" [(ngModel)]="replyText" placeholder="Optional comments...">
                  </textarea>
                </div>
              </div>
            </div>
          </div>
          <div class="col-6">
            <div class="row">
              <div class="col-5 left-heading">
                <label for=""> Supported Document</label>
                <span class="pull-right">:</span>
              </div>
              <div class="col-7">
                <input type="file" id="image" name="image" required="">
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal" #closeBtn>Close</button>
        <button type="button" class="btn btn-warning" (click)="sendReply(selectedRequest, false)" *ngIf="isRejectable(selectedRequest)">Reject Inquiry</button>
        <button type="button" class="btn btn-success" (click)="sendReply(selectedRequest, true)" *ngIf="isAcceptable(selectedRequest)">Accept Inquiry</button>

        <button type="button" class="btn btn-primary" (click)="showAdminCalendar(true)" *ngIf="isSchedulable(selectedRequest)"
        data-toggle="modal" data-target="#exampleModal1" data-dismiss="modal">Schedule Appointment</button>

        <button type="button" class="btn btn-warning" (click)="updateAppReq(selectedRequest, 6)" *ngIf="isPcAppReq(selectedRequest)">Reject Appointment</button>
        <button type="button" class="btn btn-success" (click)="updateAppReq(selectedRequest, 5)" *ngIf="isPcAppReq(selectedRequest)">Accept Appointment</button>

        <button type="button" class="btn btn-primary" (click)="showAdminCalendar(true)" *ngIf="isReschedulable(selectedRequest)"
        data-toggle="modal" data-target="#exampleModal1" data-dismiss="modal">Re-schedule Appointment</button>

        <button type="button" class="btn btn-danger" (click)="updateAppReq(selectedRequest, 10)" *ngIf="isAdminRespUpdate(selectedRequest)">Cancelled</button>
        <button type="button" class="btn btn-warning" (click)="updateAppReq(selectedRequest, 9)" *ngIf="isAdminRespPendUpdate(selectedRequest)">Pending</button>
        <button type="button" class="btn btn-success" (click)="updateAppReq(selectedRequest, 8)" *ngIf="isAdminRespUpdate(selectedRequest)">Confirmed</button>

      </div>
    </div>
  </div>
</div>
